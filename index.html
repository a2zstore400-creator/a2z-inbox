<script>
    const SUPABASE_URL = 'https://cdfvubqbujwjvkbztrvp.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_AUFSPxGYb0Vl_C3rbEw1gg_E75YdCop';

    // التعديل هنا: غيرنا اسم المتغير لـ _supabase
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function fetchEmails() {
        const list = document.getElementById('emails-list');
        const { data, error } = await _supabase
            .from('emails')
            .select('*')
            .order('created_at', { ascending: false });

        if (error) {
            console.error(error);
            list.innerHTML = "خطأ في تحميل البيانات!";
            return;
        }

        if (data.length === 0) {
            list.innerHTML = "لا توجد رسائل حالياً.";
            return;
        }

        list.innerHTML = data.map(email => `
            <div class="email-card">
                <div class="email-info">
                    <span>من: ${email.sender}</span> | 
                    <span>إلى: <span class="tag">${email.recipient}</span></span> | 
                    <span>التاريخ: ${new Date(email.created_at).toLocaleString('ar-EG')}</span>
                </div>
                <div class="subject">${email.subject}</div>
                <div class="body-content">${email.body_text}</div>
            </div>
        `).join('');
    }

    fetchEmails();
</script>
