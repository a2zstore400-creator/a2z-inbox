<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2Z Mail | Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f8fafc; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .register-card { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); width: 100%; max-width: 450px; text-align: center; }
        .logo { font-size: 2rem; font-weight: 900; color: #00439c; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #e2e8f0; border-radius: 10px; font-family: 'Cairo'; box-sizing: border-box; }
        .btn-register { width: 100%; padding: 15px; background: #00439c; color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 1rem; transition: 0.3s; }
        .btn-register:hover { background: #00337a; }
        .hint { font-size: 0.8rem; color: #64748b; margin-top: -10px; margin-bottom: 15px; text-align: right; }
        .login-link { margin-top: 20px; display: block; color: #00439c; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

    <div class="register-card">
        <div class="logo">A2Z Mail</div>
        <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ âœ¨</h2>
        
        <input type="text" id="reg-username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù…Ø«Ù„Ø§Ù‹: Ø±Ù…Ø¶Ø§Ù†)">
        
        <input type="text" id="reg-email" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (Ù…Ø«Ù„Ø§Ù‹: ramadan)">
        <div class="hint">Ø¨Ø±ÙŠØ¯Ùƒ Ø³ÙŠÙƒÙˆÙ†: example@a2z-mail.com</div>

        <input type="email" id="reg-recovery" placeholder="Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ (Yahoo, Gmail, Outlook)">
        <div class="hint" style="color:#00439c">Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø­Ø³Ø§Ø¨Ùƒ Ù„Ùˆ Ù†Ø³ÙŠØª Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯</div>

        <input type="password" id="reg-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        
        <button class="btn-register" onclick="handleRegister()" id="reg-btn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ğŸš€</button>
        
        <a href="login.html" class="login-link">Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ ÙØ¹Ù„Ø§Ù‹ØŸ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù…Ù† Ù‡Ù†Ø§</a>
    </div>

    <script>
        // Ø±Ø¨Ø· Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ [cite: 2026-02-14]
        const S_URL = 'https://cdfvubqbujwjvkbztrvp.supabase.co';
        const S_KEY = 'sb_publishable_AUFSPxGYb0Vl_C3rbEw1gg_E75YdCop';
        const myApp = supabase.createClient(S_URL, S_KEY);

        async function handleRegister() {
            const user = document.getElementById('reg-username').value.trim();
            const mailPart = document.getElementById('reg-email').value.trim();
            const recovery = document.getElementById('reg-recovery').value.trim();
            const pass = document.getElementById('reg-password').value.trim();

            if(!user || !mailPart || !recovery || !pass) return alert('ÙŠØ§ Ù…Ø¯ÙŠØ±ØŒ Ù„Ø§Ø²Ù… ØªÙ…Ù„Ø§ ÙƒÙ„ Ø§Ù„Ø®Ø§Ù†Ø§Øª!');
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø´ÙƒÙ„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ [cite: 2026-02-14]
            const fullEmail = mailPart.includes('@') ? mailPart : `${mailPart}@a2z-mail.com`;
            const btn = document.getElementById('reg-btn');
            
            btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';
            btn.disabled = true;

            try {
                // 1. ÙØ­Øµ Ù„Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù…Ø­Ø¬ÙˆØ² Ù‚Ø¨Ù„ ÙƒØ¯Ø© [cite: 2026-02-14]
                const { data: exist } = await myApp.from('a2z_users').select('id').eq('email_address', fullEmail).maybeSingle();
                
                if(exist) {
                    alert('Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø¯Ù‡ Ù…Ø­Ø¬ÙˆØ² Ù„ØºÙŠØ±ÙƒØŒ Ø¬Ø±Ø¨ Ø§Ø³Ù… ØªØ§Ù†ÙŠ!');
                    btn.innerText = 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ğŸš€';
                    btn.disabled = false;
                    return;
                }

                // 2. Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ [cite: 2026-02-14]
                const { error } = await myApp.from('a2z_users').insert([{
                    username: user,
                    email_address: fullEmail,
                    recovery_email: recovery, 
                    password: pass,
                    status: 'active'
                }]);

                if(!error) {
                    alert('Ù…Ø¨Ø±ÙˆÙƒ ÙŠØ§ Ø±Ù…Ø¶Ø§Ù†! Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­ âœ…');
                    window.location.href = 'login.html'; // ÙŠØ­ÙˆÙ„Ù‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                } else {
                    console.error(error);
                    alert('ÙÙŠÙ‡ Ù…Ø´ÙƒÙ„Ø© Ø­ØµÙ„ØªØŒ Ø§ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ ÙØ¹Ù„Øª Ø§Ù„Ù€ RLS ÙÙŠ Supabase');
                }
            } catch (err) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹');
            } finally {
                btn.innerText = 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ğŸš€';
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
